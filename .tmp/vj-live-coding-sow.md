# VJモード ライブコーディング機能 SOW (Statement of Work)

## 概要
VJモードにおいて、フルスクリーン表示を維持したまま、シェーダーコードを前面に表示して編集できる機能を実装する。これにより、観客に対してコーディングプロセスを見せながら、リアルタイムでビジュアルを変更できるパフォーマンスが可能になる。

## 目的
- VJパフォーマンス中にライブコーディングを行い、観客にコーディングプロセスを見せる
- フルスクリーン環境を維持しながら、コード編集を可能にする
- 既存の機能に影響を与えずに、新機能を追加する

## 要件

### 機能要件
1. **コードオーバーレイ表示**
   - VJモード中にキーボードショートカット（例：Ctrl+E）でコードエディタをオーバーレイ表示
   - コードは半透明の背景で表示され、背後のビジュアルが見える
   - 表示位置、サイズ、透明度を調整可能

2. **インラインエディタ**
   - シンプルなテキストエディタ（Monaco Editorではなく軽量なもの）
   - シンタックスハイライト（基本的なGLSL対応）
   - 基本的な編集機能（カーソル移動、選択、コピー&ペースト）
   - フォントサイズ調整機能

3. **リアルタイム反映**
   - 編集内容は即座にシェーダーに反映
   - コンパイルエラーは控えめに表示（パフォーマンスを妨げない）

4. **表示モード**
   - コード全体表示モード
   - 編集中の部分のみ表示モード
   - コードのスクロールアニメーション（自動スクロール）

### 非機能要件
1. **パフォーマンス**
   - VJモードのFPSに影響を与えない
   - 軽量な実装（追加のライブラリは最小限）

2. **互換性**
   - 既存のVJモード機能との共存
   - 既存のキーボードショートカットとの衝突回避

3. **ユーザビリティ**
   - 直感的な操作
   - 最小限のUIで最大限の機能

## 実装計画

### フェーズ1: 基本実装（優先度: 高）
1. VJMode.svelteにコードオーバーレイコンポーネントを追加
2. キーボードショートカットでの表示/非表示切り替え
3. 基本的なテキスト編集機能

### フェーズ2: エディタ機能強化（優先度: 中）
1. シンタックスハイライト実装
2. エラー表示機能
3. フォントサイズ調整

### フェーズ3: 演出機能（優先度: 低）
1. コードアニメーション（タイピングエフェクト）
2. 自動スクロール機能
3. 複数の表示モード

## リスクと対策

### リスク1: パフォーマンスへの影響
- **対策**: 軽量なテキストエディタの使用、必要最小限のDOM操作

### リスク2: 既存機能との競合
- **対策**: 独立したコンポーネントとして実装、既存のコードへの変更を最小限に

### リスク3: キーボードイベントの競合
- **対策**: エディタアクティブ時は他のショートカットを無効化

## 成功基準
1. VJモード中にコードを表示・編集できる
2. 60FPSを維持できる
3. 既存の機能が正常に動作する
4. 観客から見て魅力的なビジュアル表現

## タイムライン
- フェーズ1: 2-3時間
- フェーズ2: 1-2時間
- フェーズ3: 1-2時間

## 技術選定
- **エディタ**: CodeMirror 6（軽量）またはカスタムテキストエリア
- **シンタックスハイライト**: Prism.js（軽量）またはカスタム実装
- **スタイリング**: CSS-in-JSを避け、通常のCSSで実装

## 影響範囲
- 変更対象ファイル:
  - `src/components/VJMode/VJMode.svelte`
  - `src/lib/keyboard/keyboardShortcuts.ts`（新しいショートカット追加）
- 新規作成ファイル:
  - `src/components/VJMode/LiveCodeEditor.svelte`
  - `src/components/VJMode/LiveCodeEditor.css`

## 検討事項
1. モバイル対応は必要か？（現時点では不要と想定）
2. 複数のシェーダー言語対応は必要か？（GLSLのみで開始）
3. コード履歴機能は必要か？（将来的な拡張として検討）